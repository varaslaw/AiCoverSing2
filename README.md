# AISingersCoverGen (обновлённая версия)

Новая версия проекта **AISingersCoverGen** представляет собой глубокий рефакторинг оригинального AICoverGen с целью упростить установку, ускорить работу и добавить поддержку современных методов извлечения высоты тона. Проект создан для генерации вокальных каверов с помощью моделей **Retrieval‑based Voice Conversion (RVC)** и предоставляет удобный веб‑интерфейс на базе Gradio.

## Особенности

* **Упрощённая установка** — все зависимости собраны в `requirements.txt`, который можно установить одной командой: `pip install -r requirements.txt`. Не требуется переустанавливать системный Python.
* **Современный веб‑интерфейс** — реализован с использованием Gradio 4.x с приятной цветовой схемой (сине‑зелёная тема), возможностью записи аудио прямо из браузера, загрузки локальных файлов и управления параметрами конвертации.
* **Поддержка FCPE** — новый метод извлечения высоты тона **Fast Context‑based Pitch Estimator** (FCPE) обеспечивает баланс скорости и качества. Также доступны RMVPE, Crepe, Harvest, Dio и гибридный режим (например, `rmvpe+fcpe`).
* **Тонкая настройка высоты и тембра** — ползунки для транспонирования (±16 полутонов с дробными значениями), изменения форманты, скорости микширования (RMS), радиуса медианного фильтра, уровня защиты беззвучных согласных, индексации голоса, автотюна и др.
* **Выбор формата вывода** — поддерживаются WAV и MP3. Можно сохранить отдельные дорожки (вокал/инструментал) или только итоговый микс.
* **Управление моделями** — возможность скачивать модели RVC из MEGA и других источников, загружать собственные `.pth`/`.index` файлы через WebUI, объединять несколько моделей для получения уникального голоса.
* **CLI‑интерфейс** — для автоматизации доступен командный интерфейс: `python cli.py -i input.wav -m модель --pitch 2 --f0_method fcpe ...`.

## Установка

1. Склонируйте репозиторий или скачайте архив с исходным кодом:

   ```bash
   git clone https://github.com/varaslaw/AISingersCoverGen.git
   cd AISingersCoverGen
   ```

2. Установите Python 3.10 или новее. Проект протестирован на Python 3.10 и 3.11.
3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

4. Скачайте необходимые модели для разделения вокала и вывода фич (MDXNET, Hubert и RMVPE). Для этого запустите:

   ```bash
   python src/download_models.py
   ```

   Скрипт загрузит модели в каталоги `mdxnet_models` и `rvc_models`.

## Запуск WebUI

Чтобы запустить веб‑интерфейс, выполните команду:

```bash
python src/webui.py --share
```

Параметр `--share` создаёт публичную ссылку, что удобно при запуске в Google Colab. После старта сервера в консоль будет выведен адрес вида `http://127.0.0.1:7860` или публичный URL. Перейдите по этой ссылке в браузере и начните работать.

### Основные элементы интерфейса

* **Выбор модели** — выпадающий список всех папок в каталоге `rvc_models`. Каждая папка должна содержать `.pth` и `.index` файл.
* **Источник аудио** — можно записать голос прямо в браузере или загрузить файл `.wav`/`.mp3`.
* **Настройка высоты тона (Transpose)** — ползунок от -16 до +16 полутонов (поддерживаются дробные значения).
* **Форманта** — позволяет изменить тембр без изменения высоты тона.
* **Метод извлечения F0** — выбор между `pm`, `harvest`, `dio`, `crepe`, `crepe-tiny`, `rmvpe`, `fcpe` и гибридными вариантами (например, `rmvpe+fcpe`).
* **Index Rate** — доля акцента исходной модели, 0–1.
* **Filter radius** — радиус медианного фильтра для сглаживания извлечённого F0.
* **RMS mix** — баланс громкости оригинального вокала и нормализованного сигнала.
* **Protect** — степень сохранения исходных согласных (0–0.5).
* **AutoTune** — включение автотюна для более точных нот.
* **Формат вывода** — `wav` или `mp3`.

Нажмите кнопку **Сгенерировать**, чтобы создать кавер. После окончания обработки файл станет доступен для скачивания.

## Запуск в Google Colab

В репозитории находится ноутбук `AISingersCoverGen_colab.ipynb` с готовыми ячейками для установки зависимостей, скачивания моделей и запуска WebUI. Откройте этот файл в Google Colab и выполните ячейки по порядку:

1. Устанавливаются необходимые библиотеки (`torch`, `torchaudio`, `faiss`, `librosa`, `gradio`, `torchfcpe` и др.).
2. Клонируется обновлённый репозиторий AISingersCoverGen (вы можете заменить URL на свой форк).
3. Запускается скрипт `src/download_models.py` для скачивания MDXNet и RVC моделей.
4. Запускается веб‑интерфейс (`python src/webui.py --share`), после чего в выводе появится публичный URL.

Процесс установки занимает несколько минут (в зависимости от скорости интернета). После запуска WebUI вы увидите ссылку вида `https://xxxx.gradio.live`; перейдите по ней и работайте с интерфейсом.

## Использование CLI

Для автоматизированного использования без веб‑интерфейса воспользуйтесь скриптом `cli.py`:

```bash
python cli.py -i input.wav -m MyModel \
    --pitch_change 2.0 \
    --f0_method fcpe \
    --index_rate 0.5 \
    --filter_radius 3 \
    --rms_mix_rate 0.25 \
    --protect 0.33 \
    --output_format mp3
```

Запустите `python cli.py -h`, чтобы увидеть все доступные параметры.

## Загрузки и подготовка моделей

Каталог `rvc_models` предназначен для хранения моделей RVC. Каждая модель находится в собственной папке и содержит файлы `.pth` и `.index`. Вы можете загрузить предобученные модели из сообщества (например, через MEGA) или обучить собственные. Для ускорения загрузок в WebUI интегрирован скачиватель моделей, поддерживающий Mega, Google Drive, Yandex Disk, Pixeldrain и др.

## Лицензионные ограничения и отказ от ответственности

Использование сгенерированного голоса запрещено для следующих целей:

* оскорбления или атаки на людей;
* пропаганда или противопоставление определённых политических, религиозных или идеологических позиций;
* публикация контента с сильными возбуждающими выражениями без корректного ограничения;
* продажа моделей голоса или сгенерированных аудиозаписей;
* умышленное подражание оригинальному владельцу голоса с целью причинить вред;
* мошенничество, связанное с кражей личных данных или телефонным фишингом.

Разработчики не несут ответственности за прямой, косвенный или иной ущерб, возникший при использовании программы.